<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Capitals Visualizer</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .info-box {
          padding: 20px;
          margin: 20px;
          background-color: #f9f9f9;
          border-left: 5px solid #2196F3;
          box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .info-box h2 {
          margin-top: 0;
          color: #333;
        }
        .info-box p {
          color: #666;
        }
      </style>
</head>
<body>
<div class="container">
    <h1>Capitals Visualizer</h1>
    <div class="info-box">
        <h3>How to use</h3>
        <p>Chose a country and press the button to visualize the chosen country's city with the most foreign capitals that are closer than its own capital.
           If you select a specific city for a chosen country then the map shows all foreign captials that are closer to that city than the capital of its own country. 
        </p>
      </div>
    <form id="mapForm">
        <div class="form-group">
            <label for="country">Country:</label>
            <select name="country" id="country" class="form-control" onchange="updateCities(this.value)">
                <option value="">Select a country</option>
                {% for country in countries %}
                <option value="{{ country }}">{{ country }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="city">City (optional):</label>
            <select name="city" id="city" class="form-control"></select>
        </div>
        <button type="button" class="btn btn-primary" onclick="showMap()">Show Map</button>
    </form>
    <div id="mapContainer"></div>
</div>
<div class="container mt-3">
    <div class="cenetr">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    Information about Capitals
                </div>
                <div class="info-box">
                    <p id="infoText"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
function updateCities(country) {
    if (!country) {
        $('#city').empty().prop('disabled', true);
        return;
    }
    $.getJSON('/get_cities/' + country, function(data) {
        $('#city').empty().prop('disabled', false).append('<option value="">Please select a city</option>');
        data.forEach(function(city) {
            $('#city').append($('<option>').val(city).text(city));
        });
    });
}

function showMap() {
    $.post('/get_map', $('#mapForm').serialize(), function(response) {
        $('#mapContainer').html(response.map);
        var count = 0;
        response.info.closer_capitals.forEach(function(capital) {
            ++count;
        });
        var infoText = 'City with the most closer foreign capitals: ' + response.info.selected_city + '(' + count + ')<ul>';
        response.info.closer_capitals.forEach(function(capital) {
            //infoText += '<li>' + capital + '</li>';
            infoText += '<li>' + capital[0] + ' - ' + capital[2] + ', ' + capital[1].toFixed(2) + ' km</li>';
        });
        infoText += '</ul>';
        $('#infoText').html(infoText);
    }, 'json');
}

</script>
</body>
</html>
